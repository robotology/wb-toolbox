# WB-Toolbox (YYYY-MM-DD) Release Notes {[`#v4`](https://github.com/robotology/wb-toolbox/tree/v4)}

This is the first release for which a changelog was introduced.

## Important Changes

- Yarp >= `3.0.0` is now a required dependency.
- The toolbox style is now defined by a [`.clang-format`](https://github.com/robotology/wb-toolbox/.clang-format) file.
  PRs must be compliant to this style in order to be merged.
- The `master` branch is protected. Only repo admins can directly push to `master` (even if this is discouraged).
- CMake 3.5 is now required.
- The toolbox is now split in three components: `WBToolboxLibrary`, `WBToolboxMex`, `WBToolboxCoder`.
- Doxygen documentation greatly improved.

## New Features

- First version that support Simulink Coder for generating C++ code from a model.
- Most of the classes now use the pimpl idiom.
- Headers have been cleaned with IWYU.
- New _SetMotorParameters_ block. It substitutes the _SetLowLevelPID_ allowing to set also motor constant and back emf constant.
- New _RelativeTransformation_ block for computing generic homogeneous transform between two frames of the model.
- New _GetMotorMeasurements_ block for retrieving position, velocity, acceleration, PWM, and current from the motors.
- New _SetMotorReferences_ block for actuating current and PWM references.
- New _QP_ block implemented with the new `QpOases` class.

### `WBToolboxLibrary`

- `BlockInformation` interface has been polished. Now it uses enums and const arguments.
- `BlockInformation` interface has new methods for handling parameters.
- `BlockInformation` does not contain anymore any reference to external dependencies (e.g. Yarp and iDynTree).
- `BlockInformation` returns const input signals.
- Implemented new logic for parsing parameters. Added `ConvertStdVector` helper and `Parameter` `Parameters` classes.
- `Log` switched to a `stringstream` implementation, and the verbosity automatically changes between `Debug` and `Release`.
- All the templates have been moved in the `cpp` file, and the allowed instantiations are now explicitly specialized or declared in the header.
- Improved the logic to compute the number of block's parameters.
- Changed many enums names and their scope for improving readability. Switched to `enum class`.
- Improved checks on Signal validity before their usage in all blocks.
- The singleton has been renamed to `WholeBodySingleton`.
- Deprecated the retain / release logic for the `RemoteControlBoardRemapper`. It was substituted by a new logic that exploits smart pointers.

### `WBToolboxMex`

- The S-Function was renames from `toolbox.cpp` to `WBToolbox.cpp`.
- Now also the `BlockInformation` object is stored in the PWork instead of being created every time.
- Checks on pointers gathered from the PWork have been improved.
- Constraints on blocks sizes have been released. Now if a Block does not set input / output port sizes, they are inherited from the signal propagation of the entire model.

### `WBToolboxCoder`

- First version of `CoderBlockInformation` class.
- First version of `WBToolbox.tlc` file for inlining the S-Function.
- First version of the C++ wrapper for executing the class autogenerated by Simulink Coder.

## Bug Fixes

### `WBToolboxLibrary`

- Fixed the `Position` control mode of the _SetReferences_ block. It now streams new references only when they change.
- Aligned the unit of measurement of the `Reference Speed` used in the `Position` control mode of the _SetReferences_ block.
- Restore the default `Reference Speed` when _SetReferences_ terminates.
- Fixed bug which allowed modifying Signal's buffer content from an const object.

### `WBToolboxMex`

### `WBToolboxCoder`

## CMake

- Matlab is not anymore a required dependency. If Matlab is not found, the S-Function, `SimulinkBlockInformation`, and `MxAnyType` are not compiled. However, the `WBToolboxLibrary` and the `WBToolboxCoder` targets build succesfully.

## Other

- Added Travis CI tests for Linux and macOS on gcc and clang. They now build matlab-independent targets.
- Added Appveyor tests for Visual studio 2015 and 2017 for matlab-independent targets.
- `MxAnyType` is now a shared library.
- Added the `clock_rpc.thrift` file. `ClockServer` sources can now be easily generated again during project configuration by enabling `ALLOW_IDL_GENERATION`.
- All files now include the license header.

## Contributors

This is a list of people that contributed to this release (generated from the git history using `git shortlog -ens --no-merges v3.0..v4`):

```
```
